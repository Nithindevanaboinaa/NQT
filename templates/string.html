<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>String Questions - Progress Tracker</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-4">
      <h1 class="text-center">String Questions - TCS NQT Tracker</h1>
      <nav class="nav justify-content-center my-3">
        <a class="nav-link active" href="{{url_for('home')}}">Home</a>
        <a class="nav-link" href="{{url_for('array')}}">Arrays</a>
        <a class="nav-link" href="{{url_for('string')}}">Strings</a>
        <a class="nav-link" href="{{url_for('numbersystem')}}">Number System</a>
        <a class="nav-link" href="{{url_for('numbers')}}">Numbers</a>
        <a class="nav-link" href="{{url_for('sorting')}}">Sorting</a>
      </nav>
      <h2 class="mt-4">String Questions</h2>
      <div class="progress my-3">
        <div id="progressBar" class="progress-bar bg-danger" style="width: 0%">
          0%
        </div>
      </div>
      <button class="btn btn-danger mb-3" id="resetProgress">
        Reset Progress
      </button>
      <table class="table table-bordered" id="taskTable">
        <thead>
          <tr>
            <th>#</th>
            <th>Question</th>
            <th>Solution</th>
            <th>Done</th>
          </tr>
        </thead>
        <tbody>
          <!-- Questions will be dynamically loaded here -->
        </tbody>
      </table>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const taskTable = document
          .getElementById("taskTable")
          .querySelector("tbody");
        const progressBar = document.getElementById("progressBar");

        async function loadTasks() {
          const response = await fetch(
            "http://127.0.0.1:5000/get_questions/Strings"
          );
          const tasks = await response.json();

          taskTable.innerHTML = "";
          tasks.forEach((task, index) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${index + 1}</td>
              <td>${task.question}</td>
              <td><a href="${task.url}" class="text-primary">Solution</a></td>
              <td><input type="checkbox" class="doneCheckbox" ${
                task.done ? "checked" : ""
              }></td>
            `;
            taskTable.appendChild(row);
          });

          updateProgress();
        }

        async function updateTask(question, done) {
          await fetch("http://127.0.0.1:5000/update_done", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ page: "Strings", question, done }),
          });
          updateProgress();
        }

        async function resetProgress() {
          const response = await fetch(
            "http://127.0.0.1:5000/reset_progress/Strings",
            {
              method: "POST",
            }
          );
          if (response.ok) {
            await loadTasks();
            alert("Progress reset successfully!");
          }
        }

        function updateProgress() {
          const checkboxes = document.querySelectorAll(".doneCheckbox");
          const total = checkboxes.length;
          const completed = Array.from(checkboxes).filter(
            (cb) => cb.checked
          ).length;
          const percentage = Math.round((completed / total) * 100);
          progressBar.style.width = `${percentage}%`;
          progressBar.textContent = `${percentage}%`;
          progressBar.classList.toggle("bg-danger", percentage < 50);
          progressBar.classList.toggle("bg-success", percentage >= 50);
        }

        document.addEventListener("change", (e) => {
          if (e.target.classList.contains("doneCheckbox")) {
            const question = e.target.closest("tr").children[1].textContent;
            updateTask(question, e.target.checked);
          }
        });

        document
          .getElementById("resetProgress")
          .addEventListener("click", resetProgress);

        loadTasks();
      });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
